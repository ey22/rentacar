<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
        <script type="text/javascript" src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />

        <style>
        .logoImage{
            position: absolute;
            left: 10px;
            top:1px;
        }
        .title{
            display: flex;
            position: absolute;
            background-color: rgb(204, 153, 102,0.3);
            color:black;
            left: 0; 
            width: 100%; 
            height: 100%;
            align-items: center;
            
        } 
        .white{
            position: absolute;
            background-color: white;
            width: 100%; 
            height: 15%;
            left:0;
            top:0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        .menuButton {
            position: absolute; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            width: 10%; 
            height: 60%;
            background-color: white; 
            border: 2px solid #ccc; 
            border-radius: 10%; 
            cursor: pointer;
            padding: 0; 
            overflow: hidden; 
            right: 3%;
            font-size: large;
            font-weight: 500;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            top: 20%;
        }
        
        .menuButton:active {
            transform: scale(0.9); 
            background-color: #f0f0f0;
        }
        .sideNavigation {
            height: 100%; 
            width: 0; 
            position: fixed; 
            background-color: white; 
            overflow-x: hidden; 
            padding-top: 60px; 
            transition: 0.5s; 
            right: 0;
            top: 0;
            z-index: 1;
            align-items: center;
        }
        .sideNavigation a{
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 35px;
            color: #818181;
            display: block;
            transition: 0.3s;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        }
        .sideNavigation a:hover {
            color: black;
        }
        .sideNavigation .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }
        .brandFilter{
            position: absolute;
            left:8cm;
            top:0;
            display: flex;
            background-color: white;
            height: 1.2cm;
            width: 5cm;
            background-color:rgb(203, 163, 123) ;
            border: 10px;
            border-style:inset;
            border-radius: 10px; 
            cursor: pointer;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #brandFilter {
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #fbf8f8;
            width: 4cm;
            height: 1.1cm;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size:large;
            border-style:inset;
            font-weight: 400;
        }
        .transmissionFilter{
            position: absolute;
            left:15cm;
            top:0;
            display: flex;
            background-color: white;
            height: 1.2cm;
            width: 5cm;
            background-color:rgb(203, 163, 123) ;
            border: 10px;
            border-style:inset;
            border-radius: 10px; 
            cursor: pointer;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #transmissionFilter{
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #fbf8f8;
            width: 4cm;
            height: 1.1cm;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size:large;
            border-style:inset;
            font-weight: 400;
        }
        .whiteBackgroundOfCarTables{
            top: 4cm;
            position: relative;
            overflow: visible;
            width: 100%;
            height: auto;
            left:0;
            background-color: white;
            flex-wrap: wrap;            
            display: flex;
            gap: 1rem; 
            padding: 1rem;
            flex-direction: column;  
            margin-top: 0;
        }
        .filterSection {
            position: relative;
            justify-content: flex-start;
            align-items: center;
            gap: 1rem; 
            padding-bottom: 1rem;
            border-bottom: 1px solid #ccc; 
            margin-top:1cm;
            margin-bottom: 5rem; 
        }
        .car-selection-next-button{
            position: absolute;
            width: 4cm;
            height: 1cm;
            background-color: rgb(204, 153, 102,0.3);           
            border-radius: 20px;
            font-size: x-large;
            font-weight: 600;  
            top:0.5cm;
            right: 0.5cm;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
       }
       .car-selection-back-button{
            position: absolute;
            width: 4cm;
            height: 1cm;
            background-color: rgb(204, 153, 102,0.3);           
            border-radius: 20px;
            font-size: x-large;
            font-weight: 600;  
            top:0.5cm;
            left: 0.5cm;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
       }
        .carBox {
            display: flex;
            align-items: center;
            background-color: #e6e6e6;
            width: 95%;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 1rem;
            height: 6cm;
        }
        .carBox:hover {
            transform: translateY(-5px);
            cursor: pointer;
        }
        .carImage {
            width: 9cm;
            height: 6cm;
            border-radius: 8px;
            margin-right: 2rem;
        }
        .carInformation {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: medium;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-weight: 600;
            justify-content: space-between;
        }     
        .carPrice{
            font-size: x-large;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-weight: 600;
            margin-left: auto;
            flex-direction: column;  
        }
        .selectButton{
            height: 2cm;
            width: 4cm;
            background-color:rgb(203, 163, 123) ;
            border: 10px;
            font-size:x-large;
            border-style:ridge;
            font-weight: 500;
            border-radius: 10px; 
            cursor: pointer;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;      
        }
        .selectButton:focus {
            background-color: #ff9900;
            color: white;
            outline: none;
        }
        .stepper {
            display: flex;
            justify-content: space-around;
            margin: 2rem 0 2rem 8rem;
            background-color: #f5f5f5;
            padding: 0.5rem;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-style:inset;
            
        }
        .stepBox {
            flex: 1;
            text-align: center;
            padding: 1rem;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #f0f0f0;
            transition: all 0.3s ease;
            background-color: rgb(203, 163, 123); 
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
            font-weight: 400; 
        }

        .stepBox.active {
            background-color: #ff9900;
            color: white;
            font-weight: 400; 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .stepContent {
            display: none;
            padding: 2rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);  
        }

        .stepContent.active {
            display: block;
        }

        .selectionLabel {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        #locationSelection {
            padding: 0.7rem;
            border-radius: 8px;
            border: 2px solid #ccc;
            width: 50%;
            height: 1.5cm;
            font-size: large;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
            margin-top: 0.5rem;
        }

        #boxInFirstStep{
            position: relative;
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            height: 10cm;
            width: 30cm;
            background-color:rgb(206, 174, 142);
            border: 6px;
            border-style:inset;
            border-radius: 10px; 
            cursor: pointer;
            align-items: center;
            top:8%;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
            font-size: x-large;
            padding: 1rem;
            margin: auto;
        }
        .locationSelectionBoxInFirstStepBox{
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: flex-start; 
            gap: 0.5rem; 
            width: 50%;
        }
        .dateSelectionBoxInFirstStepBox{   
            display: flex;
            flex-direction: column; 
            justify-content: center;
            align-items: flex-start; 
            gap: 0.5rem;
            width: 50%; 
        }
        #dateSelectionButton {
            display: flex;
            align-items: center; 
            padding: 0.5rem;
            border-radius: 8px;
            border: 2px solid #ccc;
            font-size: large;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
            margin-top: 0.5rem;
            width: 50%;
            height: 1.5cm;
            gap: 10px;
            cursor: pointer;
        }
        .button-icon{
            width: 20px;
            height: 20px;
        }
         
        .noCarMessage {
            position: relative;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff4d4d; 
            margin-top: 3rem;
            padding: 1rem;
            background-color: #ffe6e6; 
            border-radius: 10px;
            border: 1px solid #ff9999;
            width: 85%; 
            margin-left: auto;
            margin-right: auto;
            top:3cm;
        }
        .box1, .box2, .box3{
            float:left;
            width: 25%;
            height: 10cm;
            margin-top: 8cm;
            margin-left: 2cm;
            background-color:white;
            border: 6px;
            border-style:inset;
            border-radius: 10px; 
            cursor: pointer;

        }
        #extrasPage{
            flex-direction: column;
            display: flex;
            position: relative;
            background-color: white;
            width: 100%;
            height: 50%;
            top:50%;
            align-items: center;
            
        }
        #extrasPage h1{
            position: absolute;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size:xx-large;
            font-weight: 600;
            top:5cm;
            left:2cm;
            
        }
        #extrasPage h2{
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size:xx-large;
            font-weight: 400;
            margin-left:1cm;
        }
        .icon{
            position: relative;
            height: 30px;
            width: 30px;
            top:8px;
        }
        .protectionPrice{
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size:xx-large;
            font-weight: 400;
            margin-left:1cm;
        }
        .selectButtonForProtection{
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size: large;
            font-weight: 500;
            background-color: rgb(204, 153, 102,0.3);
            border-radius: 10px;
            width: 2cm;
            height: 1cm;
           

        }.selectButtonForProtection:focus{
            background-color: #ff9900;
        }
        
        .complete-reservation-button{
            position: relative;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size: large;
            font-weight: 600;
            background-color: rgb(204, 153, 102,0.3);
            border-radius: 10px;
            width: auto;
            height: 1.5cm;
            bottom:1.5cm;
            left: 80%;
        }
        .back-button-in-review{
            position: absolute;
            bottom:2cm;
            right: 85%;
            width: 4cm;
            height: 1cm;
            background-color: #fff; 
            border-radius: 20px;
            font-size: x-large;
            font-weight: 600;  
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        }
        

        #step2 p{
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            font-size:smaller;
        }
        .totalPriceBox {
            position: absolute;
            top: 1rem;
            right: 5cm;
            padding: 1rem;
            border: 2px solid #ccc;
            border-radius: 8px;
            background-color: rgb(204, 153, 102,0.3);
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            width: 200px;
        }

        .totalPriceBox h2 {
            font-size: 16px;
            margin: 0;
            font-weight: bold;
            align-items: center;
        }

        .totalPriceBox p {
            font-size: 20px;
            margin: 0;
            font-weight: normal;
        }
       
        #daterangeInput {
            margin-top: 10px;
            font-size: 16px;
            width: 7cm;
            max-width: 300px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
            padding: 0.7rem;
            border-radius: 8px;
            border: 2px solid #ccc;
        }
       .dateSelectionBoxInFirstStepBox img{
            margin-top: 15px;
       }
       .next-button{
            position: absolute;
            width: 4cm;
            height: 1cm;
            background-color: #fff; 
            border-radius: 20px;
            font-size: x-large;
            font-weight: 600;  
            bottom: 0.5cm;
            right: 0.5cm;
            font-family:'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
       }
       .next-button-in-extras{
            position: absolute;
            width: 4cm;
            height: 1cm;
            background-color: #fff; 
            border-radius: 20px;
            font-size: x-large;
            font-weight: 600;  
            top: 19cm;
            right:2cm;
       }
       .back-button-in-extras{
            position: absolute;
            width: 4cm;
            height: 1cm;
            background-color: #fff; 
            border-radius: 20px;
            font-size: x-large;
            font-weight: 600;  
            top: 19cm;
            left:2cm;
       }

       #whiteBackgroundOfReview{
        top: 4cm;
        position: relative;
        overflow: visible;
        width: 100%;
        height: auto;   
        left:0;
        background-color: white;
        flex-wrap: wrap;            
        display: flex;
        gap: 1rem; 
        padding: 1rem;
        flex-direction: column;  
        margin-top: 0;
       }
       
       .reviewInformation {
        font-size: 16px;
        color: black;
        flex-direction: row;
        line-height: 0.4cm;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 

        }
        .boxInReviewPage{
        position: relative;
        display: flex;
        justify-content: space-between;
        height: 15cm;
        width: 10cm;
        background-color: rgb(204, 153, 102,0.3);
        border: 1px;
        border-style:inset;
        border-radius: 8px; 
        cursor: pointer;
        top:10%;
        left:35%;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
        font-size: x-large;
        padding: 1rem;
       
        }
        .reviewInformation u{
            position: absolute;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
            font-size: large;
        }
        #selectedImage{
            width: 5cm;
            height: 3cm;
        }
        #showReservation{
            background-color: white;
            color: black;

        }
        #showReservation h1{
            position: relative;
            font-size: medium;
            top:0;
            left: 0.5cm;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
        }
        .reservationBox {
            display: flex;
            position: relative;
            flex-direction: column;
            align-items: center;
            background-color: #e6e6e6;
            width: 95%;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            margin-bottom: 1rem;
            height: auto;           
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 
            font-size: small;
            top: 0.2cm;
        }
        .reservationBox h3{
            font-weight: 300;
        }
        .reservationDetails{
            margin-top: 0.5cm;
            background-color: white;
            width: 80%;
            height:auto;
            padding: 0.5cm;
            border-radius: 10px;
        }
        input::placeholder {
            font-size: large;
            color: black;
            font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif; 

        }
        .selectButton.selected {
            background-color: #ff9900;
            color: white;
            outline: none;
        }
                
        </style>
        <link rel="icon" href="images/car_icon.png">
    </head>
    <body>
        <div class="title">
            <div class="boxInFirstStep" id="boxInFirstStep"> 
                <div class="locationSelectionBoxInFirstStepBox">
                    <label for="locationSelection">Pick up & Return location </label>
                    <select id="locationSelection">
                        <option value="" selected disabled>üìç Select a location</option>
                        <option value="Istanbul">üìç Istanbul</option>
                        <option value="Berlin">üìç Berlin</option>
                        <option value="Paris">üìç Paris</option>
                        <option value="Roma">üìç Roma</option>
                    </select>
                </div>
         
                <div class="dateSelectionBoxInFirstStepBox" id="dateSelectionBoxInFirstStepBox">
                    <label for="dateSelection">Pick up date</label>
                    <div>
                        <input type="text" name="daterange" id="daterangeInput" placeholder="Select Date Range">
                        <img src="https://img.icons8.com/?size=100&id=23&format=png&color=000000" style="float:inline-start" width="30" height="30">
                    </div>                    

                </div>
                    <button class="next-button" type="button" onclick="handleLocationSelection()">Next</button>
                </div>                        
            </div>
            
            <div id="carContainer" class="whiteBackgroundOfCarTables" style="display: none;">  
                <div class="filterSection" id="filterSection">
                    <div class="brandFilter">
                        <label for="brandFilter"></label>
                        <select id="brandFilter" onchange="filterCars()" >
                            <option value="" selected disabled>Brand</option>
                            <option value="All" selected>All Brands </option>
                            <option value="Audi">Audi</option>
                            <option value="Peugeot">Peugeot</option>
                            <option value="Volkswagen">Volkswagen</option>
                            <option value="Ford">Ford</option>
                            <option value="Volvo">Volvo</option>
                            <option value="Mercedes">Mercedes</option>
                        </select>
                    </div>
    
                <div class="transmissionFilter">
                    <label for="transmissionFilter"></label>
                    <select id="transmissionFilter" onchange="filterCars()" >
                        <option value="" selected disabled>Transmission Type</option>
                        <option value="All" selected>All Transmission Types</option>
                        <option value="Manuel">Manuel</option>
                        <option value="Automatic">Automatic</option>
                    </select>
                </div>
                <button class="car-selection-back-button" onclick="switchStep(1)">Back</button>
                <button class="car-selection-next-button" onclick="handleSelection('${car.brand}', '${car.name}', '${car.price}', '${car.imageUrl}')">Next</button>
                <div id="noCarMessage" class="noCarMessage" style="display: none;">
                    There are no cars with the desired specifications. Please try different filters.
                </div>
                </div> 
            </div>        

        </div>         
        <div class="white">
            <img class="logoImage" src="./images/Logo.webp" alt="logo of car" style="width: 8%;height:100%;">
                <button type="button" class="menuButton" onclick="openNav()">My reservations</button>
                <div class="sideNavigation" id="sideNavigation">
                    <a href="javascript:void(0)" class="closebtn" onclick="closeNavigation()">&times;</a>
                    <div class="showReservation" id="showReservation">
                        <h1>My Reservations</h1>
                        <div class="reservationBox" id="reservationBox">                    
                            </div>
                    </div>
            </div>


            <div class="stepper">
                <div class="stepBox" id="step1">
                    Step 1: Location Selection
                </div>
            
                <div class="stepBox" id="step2">
                    Step 2: Car Selection
                </div>
            
                <div class="stepBox" id="step3">
                    Step 3: Extras
                </div>

                <div class="stepBox" id="step4">
                    Step 4: Review
                </div>
            </div>
        </div>
        <div class="extrasPage" id="extrasPage">
            <h1>Protection Plans</h1>
        </div>

        <div class="reviewPage" id="reviewPage">
            <div class="whiteBackgroundOfReview" id="whiteBackgroundOfReview">
                <div class="boxInReviewPage" id="boxInReviewPage">
                </div>
                <button class="back-button-in-review" onclick="switchStep(3)">Back</button>
               <script>
                var userId = sessionStorage.getItem("userId");
                console.log("id is" + userId);
               </script>
                <button class="complete-reservation-button" id="complete-reservation-button" onclick="alert('Your reservation is successfully completed!'); postReservation(); switchStep(1);"> Complete the reservation</button>
            </div>
        </div>
        
        
        <script>
        function resetStep1() {
            const dateRangeInput = document.getElementById("daterangeInput");
            $(dateRangeInput).val(''); // Input alanƒ±nƒ± temizle
            selectedPickUpDate = null;
            selectedReturnDate = null;
        }

            function openNav(){
                document.getElementById("sideNavigation").style.width = "400px";  
                showReservation();
            }
            function closeNavigation() {
                document.getElementById("sideNavigation").style.width = "0";
            }
            var days;
            var selectedPickUpDate;
            var selectedReturnDate;
            document.addEventListener("DOMContentLoaded", function () {
            const dateRangeInput = document.getElementById("daterangeInput");

            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1); 
            $(dateRangeInput).daterangepicker({
                opens: 'left', 
                locale: {
                    format: 'MM/DD/YYYY' 
                },
                autoUpdateInput: false,
                minDate: moment(tomorrow).format('MM/DD/YYYY') 
            });
    
            $(dateRangeInput).on('apply.daterangepicker', function (ev, picker) {
                days = picker.endDate.diff(picker.startDate, 'days') + 1; 
                selectedPickUpDate = picker.startDate.format('MM/DD/YYYY');
                selectedReturnDate = picker.endDate.format('MM/DD/YYYY')
                console.log("x:" + days);

                $(this).val(`${picker.startDate.format('MM/DD/YYYY')} - ${picker.endDate.format('MM/DD/YYYY')}`);
                
            });
        });
            
            function handleLocationSelection() {
                const location = document.getElementById("locationSelection").value;
                if (location) {
                    switchStep(2);
                }
                else{
                    alert("Please select a location!");
                }
            }

            async function switchStep(stepNumber) {
                const stepBoxes = document.querySelectorAll(".stepBox");
                stepBoxes.forEach(box => box.classList.remove("active"));
                const currentStep = document.getElementById(`step${stepNumber}`);
                currentStep.classList.add("active");
                document.getElementById("whiteBackgroundOfReview").style.display = "none"; 
                document.getElementById("extrasPage").style.display = "none"; 
                document.getElementById("carContainer").style.display = "none";
                document.getElementById("filterSection").style.display = "none";
                document.getElementById("boxInFirstStep").style.display = "none";
                
                if (stepNumber === 1) {
                    document.getElementById("boxInFirstStep").style.display="flex";
                    const locationSelection = document.getElementById("locationSelection");
                    locationSelection.value="";
                    document.getElementById("step2").innerHTML = `
                    Step 2: Car Selection
                `;
                resetStep1();
                }else if (stepNumber === 2 && selectedButtonId) {
                    document.getElementById("carContainer").style.display = "block";
                    document.getElementById("filterSection").style.display = "block";
                    const brandSelect = document.getElementById("brandFilter");
                    const transmissionSelect = document.getElementById("transmissionFilter");
                    brandSelect.value = "All";
                    transmissionSelect.value = "All";
                    await loadCars();
                    console.log(selectedButtonId);
                    const selectedButton = document.getElementById(selectedButtonId);
                    selectedButton.classList.add("selected");
                    document.getElementById("step3").innerHTML = `
                    Step 3: Extras
                `;

                } else if (stepNumber === 2) {
                    console.log(locationSelection);
                    if (!selectedPickUpDate || !selectedReturnDate) {
                        alert("Please select date!");
                        switchStep(1);
                        return;
                    }
                    document.getElementById("carContainer").style.display = "block";
                    document.getElementById("filterSection").style.display = "block";
                    const brandSelect = document.getElementById("brandFilter");
                    const transmissionSelect = document.getElementById("transmissionFilter");
                    brandSelect.value = "All";
                    transmissionSelect.value = "All";
                    await loadCars();
                    document.getElementById("step3").innerHTML = `
                    Step 3: Extras
                `;
                } else if (stepNumber === 3) {
                    document.getElementById("extrasPage").style.display = "block";
                    if (!selectedName) {
                        alert("Please select car!");
                        switchStep(2);
                        return;
                    }
                    await loadExtras(); 
                    setTimeout(() => {
                    const basicProtectionButton = document.getElementById("basicProtectionButton");
                    if (basicProtectionButton) {
                        basicProtectionButton.click(); 
                        basicProtectionButton.focus(); 
                    }
                }, 50); 

                }else if (stepNumber === 4) {
                    await loadReview();
                    document.getElementById("whiteBackgroundOfReview").style.display = "block"; 
                }
            }

            var varPrice=0;
            async function filterCars() {
                const brand = document.getElementById("brandFilter").value || "All";;
                const transmission = document.getElementById("transmissionFilter").value || "All";;
            
            try {
                const response = await fetch(`http://localhost:8080/cars/filter?brand=${encodeURIComponent(brand)}&transmissionType=${encodeURIComponent(transmission)}`);
                if (response.ok) {
                    const cars = await response.json();
                    
                    const container = document.getElementById("carContainer");
                    const filterSection = container.querySelector(".filterSection");
                    container.innerHTML = "";
                    container.appendChild(filterSection); 
                    if (cars.length === 0) {
                        const noCarMessage = document.getElementById("noCarMessage");
                        noCarMessage.style.display = "block";
                        

                    } else {
                        noCarMessage.style.display = "none"; 
                        cars.forEach(car => {
                            const carBox = document.createElement("div");
                            carBox.className = "carBox";
            
                            carBox.innerHTML = `
                                <img class="carImage" src="${car.imageUrl}" alt="${car.name}">
                                <div class="carInformation">
                                    <h1>${car.name}</h1>
                                    <p>Brand: ${car.brand}</p>
                                    <p>Transmission Type: ${car.transmissionType}</p>
                                    <p>Fuel Type: ${car.fuelType}</p>
                                    </div>
                                    <div class="carPrice">
                                        <p>${car.price} ‚Ç¨/day</p>
                                    <button class="selectButton" id="selectButton-${car.id}" onclick="carChoice(this, '${car.brand}', '${car.name}', '${car.price}', '${car.imageUrl}')">SELECT</button>
                                    </div>
                            `;
                            container.appendChild(carBox);
                    });
                }
                } else {
                    console.error("", response.statusText);
                }
            } catch (err) {
                console.error("Error:", err);
            }
        }
            
            async function loadCars() {
                if (document.getElementById("carContainer").style.display !== "block") {
                    return;
                }
                try {
                    const response = await fetch("http://localhost:8080/cars");
                    if (response.ok) {
                        const cars = await response.json();
                        
                        const container = document.getElementById("carContainer");
                        const filterSection = container.querySelector(".filterSection");
                        container.innerHTML = "";
                        container.appendChild(filterSection);
        
                            cars.forEach(car => {
                            const carBox = document.createElement("div");
                            carBox.className = "carBox";
                            
                            carBox.innerHTML = `
                                <img class="carImage" src="${car.imageUrl}" alt="${car.name}">
                                <div class="carInformation">
                                        <h1>${car.name}</h1>
                                        <p>Brand: ${car.brand}</p>
                                        <p>Transmission Type: ${car.transmissionType}</p>
                                        <p>Fuel Type: ${car.fuelType}</p>
                                    </div>
                                    <div class="carPrice">
                                        <p>${car.price} ‚Ç¨/day</p>
                                        <button class="selectButton" id="selectButton-${car.id}" onclick="carChoice(this, '${car.brand}', '${car.name}', '${car.price}', '${car.imageUrl}', '${car.id}')">SELECT</button>
                                    </div>
                            `;
                            container.appendChild(carBox);
                        });
                    } 
                    else {
                        console.error("", response.statusText);
                    }
                }catch (err) {
                    console.error("Error:", err);
                }
            }

            var selectedCar = ""; 
            var selectedBrand="";
            var selectedName="";
            var selectedImage="";
            var selectedCarPrice=0;
            var carId=0;
            let selectedButtonId = null;

            function carChoice(button, brand, name, price, image, id){
                if (selectedButtonId && selectedButtonId !== button.id) {
                const previousButton = document.getElementById(selectedButtonId);
                if (previousButton) {
                    console.log(previousButton);
                    console.log(button.id);
                    previousButton.classList.remove("selected");
                }
            }
                button.classList.add("selected");
                selectedButtonId = button.id;
                console.log("selectedButtonId" + selectedButtonId);
                selectedBrand=brand;
                selectedName=name;
                selectedImage=image;
                selectedCarPrice=price;
                carId=id;
            
            }
            function handleSelection(brand, name, price, image){
                varPrice=0;
                console.log(selectedBrand);
                const selectedCar = `${selectedBrand} ${selectedName}`;
                selectCar(selectedCar);
                calculatePrice(selectedCarPrice);
            }

            function selectCar(carName) {
                selectedCar = carName; 
                document.getElementById("step2").innerHTML = `
                    Step 2: Car Selection
                    <p>${selectedCar}</p>
                `;
                switchStep(3); 
            }

            function calculatePrice(price){
                varPrice+=price*days;
                console.log(varPrice);
            }
                var totalExtra=0;
                var selectedExtraPrice=0;
                var selectedExtraName="";
                var protectionId=0;

            function calculateExraPrice(extraPrice,planType,id){
                if(extraPrice==0){
                    selectedExtraPrice=extraPrice;
                    selectedExtraName=planType;
                    protectionId=id;
                    totalPrice=varPrice;
                    const totalPriceElement = document.getElementById("totalPrice");
                    totalPriceElement.innerText = `${totalPrice} ‚Ç¨`;
                }
                    totalExtra=0;
                    totalPrice=varPrice;
                    selectedExtraPrice=extraPrice;
                    selectedExtraName=planType;
                    protectionId=id;
                    totalExtra+=selectedExtraPrice*days;
                    console.log(totalExtra);
                    totalPrice=varPrice+totalExtra;
                    const totalPriceElement = document.getElementById("totalPrice");
                    totalPriceElement.innerText = `${totalPrice} ‚Ç¨`;

                    document.getElementById("step3").innerHTML = `
                    Step 3: Extras
                    <p>${planType}</p>
                `;
                }

            async function loadExtras(){
                try {
                    const response = await fetch("http://localhost:8080/plans");
                    if (response.ok) {
                        const extras = await response.json();

                        const extrasPage = document.getElementById("extrasPage");
                        
                        extrasPage.innerHTML = `
                            <h1>Protection Plans</h1>
                             <div class="totalPriceBox" id="totalPriceBox">
                                <h2>Total Price</h2>
                                <p id="totalPrice">${varPrice} ‚Ç¨</p> 
                            </div>
                            <button class="back-button-in-extras" type="button" onclick="switchStep(2)">Back </button>
                            <button class="next-button-in-extras" type="button" onclick="switchStep(4)">Next </button>
                        `;
                        extras.forEach((extra, index) => {
                        const extrasBox = document.createElement("div");
                        extrasBox.className = `box${index + 1}`; 
                        let boxContent = `
                            <h2>${extra.planType}</h2>
                            <p>
                            <img src="https://img.icons8.com/?size=100&id=70yRC8npwT3d&format=png&color=000000" alt="icon" class="icon">
                            Collision Damage Protection
                        </p>
                        `;
                                if(extra.windscreenGlassTyresProtection===false && extra.keyAndLicenceAssurance===false){
                                    boxContent+= ` 
                                    <p>
                                        <img src="https://img.icons8.com/?size=100&id=fYgQxDaH069W&format=png&color=000000" alt="icon" class="icon">
                                        Windscreen Glass Tyres Protection
                                        <br><br><img src="https://img.icons8.com/?size=100&id=fYgQxDaH069W&format=png&color=000000"alt="icon" class="icon">
                                        Key And Licence Assurance
                                        </p>
                                        `;
                                        if(extra.price==0){
                                            boxContent+= ` 
                                            <div class="protectionPrice">
                                                <p>Included</p>
                                                <button autofocus class="selectButtonForProtection" id="basicProtectionButton" onclick="calculateExraPrice('${extra.price}','${extra.planType}')" onfocus="calculateExraPrice('${extra.price}','${extra.planType}', '${extra.id}')"> Select </button>
                                                 </div>
                                            `;
                                        }
                                }else if(extra.windscreenGlassTyresProtection===true && extra.keyAndLicenceAssurance===false){
                                    boxContent+= ` 
                                    <p>
                                        <img src="https://img.icons8.com/?size=100&id=70yRC8npwT3d&format=png&color=000000" alt="icon" class="icon">
                                        Windscreen Glass Tyres Protection
                                        <br><br> <img src="https://img.icons8.com/?size=100&id=fYgQxDaH069W&format=png&color=000000"alt="icon" class="icon">
                                        Key And Licence Assurance
                                         <div class="protectionPrice">
                                                <p>${extra.price} ‚Ç¨/day</p>
                                                 <button class="selectButtonForProtection" onclick="calculateExraPrice('${extra.price}','${extra.planType}','${extra.id}')"> Select </button>
                                                 </div>
                                        </p>
                                        `;
                                }
                                else{
                                    boxContent+= `
                                     <p>
                                         <img src="https://img.icons8.com/?size=100&id=70yRC8npwT3d&format=png&color=000000" alt="icon" class="icon">
                                        Windscreen Glass Tyres Protection
                                        <br><br><img src="https://img.icons8.com/?size=100&id=70yRC8npwT3d&format=png&color=000000" alt="icon" class="icon">
                                        Key And Licence Assurance
                                        <div class="protectionPrice">
                                                <p>${extra.price} ‚Ç¨/day</p>
                                                 <button class="selectButtonForProtection" onclick="calculateExraPrice('${extra.price}','${extra.planType}','${extra.id}')"> Select </button>
                                                 </div>
                                        </p>
                                        `;
                                }
                                extrasBox.innerHTML = boxContent;
                                extrasPage.appendChild(extrasBox);
                            })
                        }
                        
                    else {
                        console.error("Failed to fetch extras:", response.statusText);
                    }
                } catch (err) {
                    console.error("Error:", err);
                }
            };
            function loadReview(){
                const boxInReviewPage = document.getElementById("boxInReviewPage");
                var username = sessionStorage.getItem("username");
                console.log(username);
                const locationValue = document.getElementById("locationSelection").value;


                boxInReviewPage.innerHTML = ` 
                    <div class="reviewInformation" id="reviewInformation"> 
                        <u><b> Driver</b></u>
                        <br>
                        <p> Username: ${username} </p>
                        <u><b> Reservation Details</b></u>
                        <br>
                        <p> Location: ${locationValue} </p>
                        <p> Pick Up Date: ${selectedPickUpDate}</p>
                        <p> Return Date: ${selectedReturnDate}</p>
                        <p> Protection Plan: ${selectedExtraName}</p>

                        <br>
                        <u><b> Vehicle</b></u>
                        <br>
                        <p>${selectedBrand} ${selectedName}</p>
                        <img class="selectedImage" id="selectedImage" src="${selectedImage}"" alt="${selectedName}">
                       <br> 
                        <u> <b>Prices</b></u>
                        <br>
                        <p> Car price for ${days} days: ${selectedCarPrice}‚Ç¨ * ${days} = ${varPrice}‚Ç¨</p>
                        <p> Protection price for ${days} days: ${selectedExtraPrice}‚Ç¨ * ${days} = ${totalExtra}‚Ç¨</p>
                        <p> Total price: <b>${totalPrice}‚Ç¨</b></p>
                    </div>
                `;
            }
            
            async function showReservation(){
                if (userId == "") {
                    console.error("User ID is missing!");
                    return;
                }
                try {
                    const response = await fetch(`http://localhost:8080/reservations/user/${userId}`);
                    if (response.ok) {
                        const reservations = await response.json();  
                        const reservationBox = document.getElementById("reservationBox");                     
                            reservationBox.innerHTML = "";
                            const reservationElement = document.createElement("div");
                            reservationElement.className = "reservationDetails";
                        if (reservations.length === 0) {
                            reservationElement.innerHTML = `
                                <b> You don't have any reservation</b>
                            `;
                            reservationBox.appendChild(reservationElement);
                            return;
                        }     
                        console.log("User ID:", userId);
                        reservations.forEach(reservation => {      
                            const reservationElement = document.createElement("div");
                            reservationElement.className = "reservationDetails";             
                            reservationElement.innerHTML = `
                                <p> <b>Car name:</b> ${reservation.carName} </p>
                                <p> <b>Car brand:</b> ${reservation.carBrand} </p>
                                <p> <b>Protection Plan:</b> ${reservation.extraName} </p>
                                <p> <b>Pick-up date:</b> ${reservation.pickUpDate} </p>
                                <p> <b>Return date:</b> ${reservation.returnDate} </p>
                                <p> <b>Total price:</b> ${reservation.totalPrice} ‚Ç¨ </p>
                            `;
                            reservationBox.appendChild(reservationElement);
                        })
                     }
                }
                catch (err) {
                console.error("Error:", err);
            }
}
            async function postReservation(){
                const pickUpDate = new Date(selectedPickUpDate);
                console.log(pickUpDate);
                const returnDate = new Date(selectedReturnDate);
                console.log(returnDate);
                const location= document.getElementById("locationSelection").value;
                console.log(location);
                console.log(protectionId);


                try {
                    const response = await fetch('http://localhost:8080/reservations', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': "application/json"
                                },
                                mode: 'cors',
                                body: JSON.stringify({
                                  userId:userId,
                                  carId:carId,
                                  protectionId:protectionId,
                                  location:location,
                                  pickUpDate:pickUpDate,
                                  returnDate:returnDate,
                                  totalPrice:totalPrice
                                }),
                    })
                    if (response.ok) {
                        console.log('Request successful!');       
                    }
                }
                 catch(err) {
                    console.error(`Error: ${err}`);
                }
            }
         </script>   
        </div> 
        <script>
            switchStep(1);
        </script>
        
            
       
    